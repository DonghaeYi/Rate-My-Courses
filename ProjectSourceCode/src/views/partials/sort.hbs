<div id="sort">
    <label for="sortmode">Sort by:</label>

    <select name="sortmode" id="sortmode" onchange="getNewResults(this.options[this.selectedIndex].value)">
        <option value="Trust">Trustworthy</option>
        <option value="Year">Year</option>
        <option value="High">Positive</option>
        <option value="Low">Negative</option>
    </select>
</div>

<script>
    var event = new Event('change');
    document.getElementById('sortmode').dispatchEvent(event);

    async function getNewResults(value) {

        const response = await fetch(`/reqreviews`, {
            method: 'POST',
            headers: ['Content-Type', 'application/json'],
            mode: 'cors',
            cache: 'default',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ sort: value }),
        })
        const reviews = await response.json()
        const parent = document.getElementById('review-container')
        for(let i = reviews.length-1; i >= 0; i--) {
            const review = reviews[i]
            const element = document.getElementById(`review${review.review_id}`)
            if (element == undefined) {
                continue
            }
            parent.insertBefore(element, parent.firstChild);
        }
        const sortElement = document.getElementById(`sort`)
        parent.insertBefore(sortElement, parent.firstChild)
    }
</script>